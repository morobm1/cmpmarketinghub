<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Velocity Tracker • Marketing Hub</title>
  <link rel="preconnect" href="https://use.typekit.net" crossorigin>
  <link rel="preconnect" href="https://p.typekit.net" crossorigin>
  <link rel="stylesheet" href="https://use.typekit.net/hqv8hwr.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <meta name="description" content="Velocity Tracker – Under construction" />
  <style>
    :root{ --brand-primary:#446472; --brand-accent:#ffb732; --brand-accent-2:#52d5ff; --brand-gray:#929497; --page-bg:#e5e7eb; --bg:#ffffff; --panel:#ffffff; --muted:#ffffff; --text:#1f2937; --subtext:#6b7280; --accent:var(--brand-accent-2); --accent-2:var(--brand-accent); --border:#e5e7eb; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:'Open Sans', Arial, sans-serif; background:var(--page-bg); color:var(--text)}
    header{padding:16px 18px; border-bottom:1px solid var(--border); position:sticky; top:0; background:#ffffff; z-index:20; display:flex; align-items:center; gap:14px; flex-wrap:wrap; box-shadow:0 2px 6px rgba(0,0,0,0.04)}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo-img{height:32px;width:auto;display:block}
    .brand .title{color:#ffb732; font-family: zooja-pro, Arial, sans-serif; font-size: clamp(36px, 5vw, 64px); line-height: 1.05}
    .pill{border:1px solid var(--border); background:#ffffff; border-radius:999px; padding:6px 10px; font-size:12px; color:#374151; display:flex; align-items:center; gap:8px}
    .pill select, .pill button{ font-family: Roboto, Arial, sans-serif; }
    .pill select{ background:#ffffff; border:1px solid #d1d5db; border-radius:8px; padding:6px 8px }
    .pill button{ background:#ffffff; color:#111827; border:1px solid #d1d5db; padding:6px 10px; border-radius:8px; cursor:pointer }
    .pill button:hover{ background:#f9fafb }

    .nav-bar{ background:#ffffff; border-bottom:1px solid var(--border); box-shadow:0 1px 3px rgba(0,0,0,0.06) }
    .nav-bar .nav-wrap{ max-width:1200px; margin:0 auto; padding:8px 16px; display:flex; gap:8px; flex-wrap:wrap }
    .nav-tab{ display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border:1px solid var(--border); border-radius:999px; color:#374151; text-decoration:none; background:#ffffff; transition: all .15s ease; font-family: Roboto, Arial, sans-serif }
    .nav-tab:hover{ background:#f3f4f6 }
    .nav-tab.active{ background:#52d5ff; border-color:#52d5ff; color:#0b1b24; font-weight:700 }

    .container{padding:18px; max-width:1200px; margin:0 auto}
    .card{ background:#ffffff; border:1px solid var(--border); border-radius:14px; box-shadow:0 1px 3px rgba(0,0,0,0.06); overflow:hidden }
    .card h3{ margin:0; padding:12px 14px 0 14px; font-size:16px; color:#374151; font-weight:800; font-family: Roboto, Arial, sans-serif }
    .card .content{ padding:14px }
    .badge{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; background:#fff7e6; color:#8a5800; border:1px solid #fde68a; font-weight:700; font-family: Roboto, Arial, sans-serif}
    .muted{ color:#6b7280 }
  </style>
</head>
<body>
  <header>
    <div class="brand"><img src="logo-main.svg" class="logo-img" alt="Capstone" /><div class="title">Marketing Hub</div></div>
    <div class="pill">
      <label for="propertySelect" style="font-size:12px;color:#6b7280">Property</label>
      <select id="propertySelect" style="min-width:220px"></select>
      <button id="logoutBtn">Logout</button>
      <button id="adminPageBtn" style="display:none">Admin</button>
    </div>
    <div class="muted" style="font-size:13px">Capstone Management Partners</div>
  </header>
  <nav id="mainNav" class="nav-bar">
    <div class="nav-wrap">
      <a href="mmp_calendar_app.html" class="nav-tab" data-tab="calendar">Marketing Calendar</a>
      <a href="marketing_contacts.html" class="nav-tab" data-tab="contacts">Marketing Contacts</a>
      <a href="promo_order_tracker.html" class="nav-tab" data-tab="promo">Promo Order Tracker</a>
      <a href="velocity_tracker.html" class="nav-tab" data-tab="velocity">Velocity Tracker</a>
      <a href="social_media_audit.html" class="nav-tab" data-tab="social">Social Media Audit</a>
    </div>
  </nav>

  <main class="container">
    <section class="card">
      <h3>Velocity Tracker</h3>
      <div class="content">
        <div class="badge">Under construction</div>
        <p class="muted" style="margin-top:8px">This page is being built. Check back soon.</p>
      </div>
    </section>
  </main>

  <script>
    const STORE_CURRENT_PROPERTY_KEY = 'mmp_current_property_v1';

    (function(){
      const nav = document.getElementById('mainNav');
      if (!nav) return;
      const path = (location.pathname || '').toLowerCase();
      nav.querySelectorAll('.nav-tab').forEach(a => {
        const href = (a.getAttribute('href') || '').toLowerCase();
        if (href && (path.endsWith(href) || path.endsWith('/' + href))) a.classList.add('active');
      });
    })();

    const els = {
      propertySelect: document.getElementById('propertySelect'),
      logoutBtn: document.getElementById('logoutBtn'),
      adminPageBtn: document.getElementById('adminPageBtn'),
    };

    async function api(path, opts={}){
      const res = await fetch('/api' + path, opts);
      if (!res.ok) throw new Error(await res.text() || ('HTTP '+res.status));
      return res;
    }

    function getAccessible(properties, me){
      const names = properties.map(p => p.name).filter(Boolean);
      if (!me) return names;
      if (me.role === 'admin') return names;
      if (me.properties === '*') return names;
      const allowed = Array.isArray(me.properties) ? me.properties : [];
      return names.filter(n => allowed.includes(n));
    }

    async function init(){
      try{
        const meRes = await fetch('/api/me');
        if (!meRes.ok){ location.href = 'index.html'; return; }
        const me = await meRes.json();
        if (els.adminPageBtn){ els.adminPageBtn.style.display = me.role === 'admin' ? '' : 'none'; els.adminPageBtn.onclick = ()=>{ location.href='mmp_admin.html'; } }
        if (els.logoutBtn){ els.logoutBtn.onclick = async ()=>{ try{ await fetch('/api/auth-logout', { method:'POST' }); }catch(e){} location.href='index.html'; }; }

        let props = [];
        try{ const pres = await api('/properties'); props = await pres.json(); }catch(e){ props = []; }
        const list = getAccessible(props, me);
        const saved = (localStorage.getItem(STORE_CURRENT_PROPERTY_KEY)||'').trim();
        const current = list.includes(saved) ? saved : (list[0] || '');
        if (els.propertySelect){
          els.propertySelect.innerHTML = list.map(p => `<option value="${p.replace(/"/g,'&quot;')}">${p}</option>`).join('');
          els.propertySelect.value = current;
          els.propertySelect.onchange = ()=>{ localStorage.setItem(STORE_CURRENT_PROPERTY_KEY, els.propertySelect.value); };
        }
      }catch(e){ location.href = 'index.html'; }
    }

    init();
  </script>
</body>
</html>
